<script src='https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js' integrity='sha512-ZDSPMa/JM1D+7kdg2x3BsruQ6T/JpJo3jWDWkCZsP+5yVyp1KfESqLI+7RqB5k24F7p2cV7i2YHh/890y6P6Sw==' crossorigin='anonymous'></script>
<%let total = 0; let shipping = 0;%>
<%order.forEach(o =>{%>
  <% total += o.totalOrder %>
  <% shipping += o.totalShipping %>
<%})%>
<div class="columns is-centered is-marginless is-paddingless is-gapless">
    <div class="column is-2"></div>
    <div class="column is-8">
        <div class="container">
            <nav class="level has-text-white">
            <%if(order[0].paymentMethod=='CC'){%>
                <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Medio de Pago</p>
                      <p class="title has-text-white">Tarjeta de Crédito</p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Referencia de Pago</p>
                      <p class="title has-text-white"><%=payment.data['ref_payco']%></p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Total</p>
                      <p class="title has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                    </div>
                  </div>
            <%}%>
            <%if(order[0].paymentMethod=='PSE'){%>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Medio de Pago</p>
                  <p class="title has-text-white">PSE</p>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Referencia de Pago</p>
                  <p class="title has-text-white"><%=payment.data['ref_payco']%></p>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Total</p>
                      <p class="title has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                </div>
              </div>
            <%}%>
            <%if(order[0].paymentMethod=='CS'){%>
                <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Medio de Pago</p>
                      <p class="title has-text-white"><%=payment.data.banco%></p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Referencia de Pago</p>
                      <p class="title has-text-white"><%=payment.data.codigoproyecto%></p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">PIN</p>
                      <p class="title has-text-white"><%=payment.data.pin%></p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Total</p>
                      <p class="title has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                    </div>
                  </div>
            <%}%>
            <%if(order[0].paymentMethod=='COD'){%>
                <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Medio de Pago</p>
                      <p class="title has-text-white">Contra Entrega</p>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Tipo de Pago</p>
                      <%if(order[0].paymentOption=='terminal'){%>
                        <p class="title has-text-white">Datáfono</p>
                      <%}else{%>
                        <p class="title has-text-white">Efectivo</p>
                      <%}%>
                    </div>
                  </div>
                  <div class="level-item has-text-centered">
                    <div>
                      <p class="heading">Total</p>
                      <p class="title has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                    </div>
                  </div>
            <%}%>
            <%if(order[0].paymentMethod=='BTC'){%>
              <div class="columns is-vcentered is-centered has-text-centered">
                <div class="column">
                  <p class="heading">Medio de Pago</p>
                  <p class="is-size-5 has-text-white">Bitcoin</p>
                </div>
                <div class="column">
                  <div class="columns is-vcentered is-centered has-text-centered">
                    <div class="column"><figure id="qrcode" class="image is-96x96 is-inline-block">
                    </figure></div>
                    <div class="column"><p class="is-size-5 is-size-7-mobile has-text-white code">1k452Yv1WJu5hKSWD4Q4JEuqqDD1EyeQi</p></div>
                  </div>
                </div>
                <div class="column">
                  <p class="heading">Total</p>
                  <p class="is-size-5 has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                </div>
              </div>
            <%}%>
            <%if(order[0].paymentMethod=='USDT-TRON20'){%>
              <div class="columns is-vcentered is-centered has-text-centered">
                <div class="column">
                  <p class="heading">Medio de Pago</p>
                  <p class="is-size-5 has-text-white">USDT Red Tron</p>
                </div>
                <div class="column">
                  <div class="columns is-vcentered is-centered has-text-centered">
                    <div class="column"><figure id="qrcode" class="image is-96x96 is-inline-block">
                    </figure></div>
                    <div class="column"><p class="is-size-5 is-size-7-mobile has-text-white code">TBDBkNrMD1p7t5SjD9JpPb8bv27cSGVuQ5</p></div>
                  </div>
                </div>
                <div class="column">
                  <p class="heading">Total</p>
                  <p class="is-size-5 has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                </div>
              </div>
            <%}%>
            <%if(order[0].paymentMethod=='USDT-ERC20'){%>
              <div class="columns is-vcentered is-centered has-text-centered">
                <div class="column">
                  <p class="heading">Medio de Pago</p>
                  <p class="is-size-5 has-text-white">USDT Red Ethereum</p>
                </div>
                <div class="column">
                  <div class="columns is-vcentered is-centered has-text-centered">
                    <div class="column"><figure id="qrcode" class="image is-96x96 is-inline-block">
                    </figure></div>
                    <div class="column"><p class="is-size-5 is-size-7-mobile has-text-white code">0x71c44fa27cc1cc6908431b13a86e276c877c23a6</p></div>
                  </div>
                </div>
                <div class="column">
                  <p class="heading">Total</p>
                  <p class="is-size-5 has-text-white">$&nbsp;<%=Math.round(total+shipping).toLocaleString('es-CO')%></p>
                </div>
              </div>
            <%}%>
            </nav>
          <section class="hero 
            <%if(order[0].currentstatus.name==='aceptado'){%>is-success<%}%>
            <%if(order[0].currentstatus.name==='pendiente'){%>is-warning<%}%>
            <%if(order[0].currentstatus.name==='fallido' || order[0].currentstatus.name==='rechazado'){%>is-danger<%}%>
          ">
                <div class="hero-body">
                  <div class="container">
                    <h1 class="title">
                      Gracias por tu compra
                    </h1>
                    <h2 class="subtitle">
                      Encuentra a continuación los detalles de tu orden
                    </h2>
                  </div>
                </div>
              </section>
            <div class="box">
            <% order.forEach(o=>{ %>
                <article class="media">
                    <figure class="media-left">
                        Pedido:&nbsp;#&nbsp;<strong><%=o.reference%></strong>
                    </figure>
                    <div class="media-content">
                        <div class="content">
                        <p class="is-capitalized has-text-black"><strong>Vendedor:&nbsp;</strong><%=o.seller.name%></p>
                        <p class="is-capitalized has-text-black"><strong>Estado:&nbsp;</strong><%=o.currentstatus.name%></p>
                        </div>
                    </div>
                    <div class="media-rigth">
                      <p>$ &nbsp;<%= Math.round(o.totalOrder+o.totalShipping).toLocaleString('es-CO')%></p>
                    </div>
                </article>
            <% }); %>
            </div>
        </div>
    </div>
    <div class="column is-2"></div>
</div>
<hr>
<div class="columns is-gapless">
  <div class="column is-2"></div>
  <div class="column is-8">
    <div class="columns is-mobile">
      <div class="column">
        <p class="has-text-left">
          <a href="/" class="button is-danger is-outlined">Seguir Comprando</a>
        </p>
      </div>
      <div class="column">
        <p class="has-text-right">
          <a href="/account/orders" class="button is-danger is-outlined">Ver Detalles</a>
        </p>
      </div>
    </div>
    <br>
    <br>
  </div>
  <div class="column is-2"></div>
</div>
<script>

  if(dataLayer){
    dataLayer.push({ ecommerce: null });  // Clear the previous ecommerce object.
    <%for(let o of order){%>
      dataLayer.push({
        'event':'purchase',
        'ecommerce': {
            'transaction_id': '<%= o.reference %>',                         // Transaction ID. Required for purchases and refunds.
            'currency': 'COP',
            //'tax': '',
            'payment': '<%= o.paymentMethod %>',
            'value': <%= o.totalOrder %>,                     // Total transaction value (incl. tax and shipping)
            'shipping': <%= o.totalShipping %>,
            'items': <%- JSON.stringify(o.products)%>
        }
      });
    <%}%>
  }

  let qrCode = ()=>{
    var typeNumber = 0;
    var errorCorrectionLevel = 'L';
    var qr = qrcode(typeNumber, errorCorrectionLevel);
    let code = document.querySelector('.code').innerHTML
    qr.addData(code);
    qr.make();
    document.getElementById('qrcode').innerHTML = qr.createImgTag();
  }

  document.addEventListener('DOMContentLoaded', function() {
    qrCode();
    }, false);
</script>